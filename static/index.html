<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>纸鹤领取中心</title>
    <!-- 引入样式表 -->
    <link rel="stylesheet" href="/static/style.css?v=2">
</head>

<body>
    <!-- 背景装饰图层 -->
    <div class="bg-shape shape-1"></div>
    <div class="bg-shape shape-2"></div>

    <!-- 主界面容器 -->
    <div class="glass-container">
        <h1>✨ 纸鹤自动领取系统</h1>

        <!-- 领取表单 -->
        <form id="claim-form">
            <div class="form-group">
                <label for="ycy_uid">易次元 UID</label>
                <input type="text" id="ycy_uid" placeholder="请输入你的UID" required autocomplete="off">
            </div>

            <div class="form-group">
                <label for="qq">QQ号 (验证密码)</label>
                <input type="text" id="qq" placeholder="请输入预留的QQ号" required autocomplete="off">
            </div>

            <button type="submit" id="submit-btn" class="btn">
                <span class="btn-text">立即领取</span>
                <div class="loader"></div>
            </button>
        </form>

        <!-- 结果展示区域 -->
        <div id="result-area">
            <div id="result-content">
                <!-- JS 会在这里插入结果 -->
            </div>
        </div>
    </div>

    <!-- 管理员入口按钮 -->
    <button id="admin-login-btn"
        style="position: fixed; top: 20px; right: 20px; z-index: 100; font-size: 14px; background: rgba(0,0,0,0.5); padding: 8px 15px; border-radius: 20px;"
        class="btn">
        🔐 管理后台
    </button>

    <!-- 管理员登录模态框 -->
    <div id="admin-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;">
        <div
            style="background: white; padding: 30px; border-radius: 12px; width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2);">
            <h3 style="margin-top: 0; color: #333; margin-bottom: 20px;">管理员验证</h3>
            <input type="password" id="admin-pwd-input" placeholder="请输入管理员密码"
                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; font-size: 16px;">
            <div style="display: flex; gap: 10px;">
                <button id="cancel-admin-btn"
                    style="flex: 1; padding: 10px; background: #f3f4f6; border: none; border-radius: 8px; cursor: pointer;">取消</button>
                <button id="verify-admin-btn"
                    style="flex: 1; padding: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">进入后台</button>
            </div>
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="/static/script.js?v=3"></script>
    <script>
        // 管理员登录逻辑
        const adminBtn = document.getElementById('admin-login-btn');
        const adminModal = document.getElementById('admin-modal');
        const cancelBtn = document.getElementById('cancel-admin-btn');
        const verifyBtn = document.getElementById('verify-admin-btn');
        const pwdInput = document.getElementById('admin-pwd-input');

        adminBtn.addEventListener('click', () => {
            adminModal.style.display = 'flex';
            pwdInput.value = '';
            pwdInput.focus();
        });

        cancelBtn.addEventListener('click', () => {
            adminModal.style.display = 'none';
        });

        // 点击背景关闭
        adminModal.addEventListener('click', (e) => {
            if (e.target === adminModal) adminModal.style.display = 'none';
        });

        async function verifyAdmin() {
            const pwd = pwdInput.value;
            if (!pwd) return;

            verifyBtn.textContent = '验证中...';
            verifyBtn.disabled = true;

            try {
                // 尝试请求一次后台API验证密码
                const res = await fetch('/api/admin/stats', {
                    headers: { 'X-Admin-Password': pwd }
                });

                if (res.ok) {
                    // 验证成功，保存密码到 Application Storage
                    sessionStorage.setItem('adminPassword', pwd);
                    window.location.href = '/admin';
                } else {
                    alert('密码错误！');
                    verifyBtn.textContent = '进入后台';
                    verifyBtn.disabled = false;
                    pwdInput.select();
                }
            } catch (e) {
                alert('连接失败，请重试');
                verifyBtn.textContent = '进入后台';
                verifyBtn.disabled = false;
            }
        }

        verifyBtn.addEventListener('click', verifyAdmin);

        pwdInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') verifyAdmin();
        });
    </script>
</body>

</html>